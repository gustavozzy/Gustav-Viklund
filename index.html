<!DOCTYPE html>
<html>
<head>
    <style>
        @font-face {
            font-family: 'printf';
            src: url('resources/PRINTF Regular.ttf') format('truetype');
        }
        
        html {
            overflow: hidden;
            cursor: none;
        }
        
        * {
            cursor: none !important;
        }
        
        body {
            background-color: rgb(0, 0, 0);
            margin: 0;
            padding: 0;
            height: 100vh;
            position: relative;
            overflow-x: auto;
            overflow-y: hidden;
            overscroll-behavior: none;
            overscroll-behavior-x: none;
            overscroll-behavior-y: none;
            cursor: none; /* Use the custom cursor instead of the native one */
        }
        
        /* Loading screen - ground starts expanded and shrinks down */
        .ground.loading {
            height: 100vh !important;
            z-index: 1999;
        }
        
        /* Ensure ground returns to normal height when loading is removed */
        .ground:not(.loading):not(.expanding) {
            height: 10vh !important;
        }
        
        /* Custom cursor: outer follows position, inner handles scale transition */
        .custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 2000;
            transform: translate3d(-100px, -100px, 0);
        }
        .custom-cursor .custom-cursor-shape {
            position: absolute;
            top: 50%;
            left: 0;
            width: 12px;
            height: 12px;
            margin: 0;
            background: rgb(255, 255, 255);
            border-radius: 0;
            transform: translateY(-50%);
            box-sizing: border-box;
            overflow: hidden;
            transition: width 320ms ease, height 320ms ease, padding 320ms ease, transform 320ms ease, background 320ms ease, border-radius 320ms ease;
        }
        .custom-cursor .custom-cursor-text {
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            font-family: 'Avenir', 'Avenir Next', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 12px;
            font-weight: bold;
            color: rgb(0, 0, 0);
            transition: opacity 320ms ease;
            line-height: 1;
        }
        .custom-cursor.is-hovering .custom-cursor-shape {
            width: max-content;
            height: 24px;
            padding: 4px 8px;
            transform: translateY(-50%);
            background: rgb(255, 255, 255);
            display: flex;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
        }
        .custom-cursor.is-hovering .custom-cursor-text {
            opacity: 1;
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            pointer-events: none;
            transform: scaleX(-1);
        }
        
        .background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            pointer-events: none;
            transform: scaleX(-1);
        }
        
        /* Fallback background for browsers that don't support the video */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(0, 0, 0);
            z-index: -1;
        }
        
        .scene-container {
            position: relative;
            height: 100%;
            width: calc(1650px + 48vh + 100px); /* Content width + start padding + end padding */
        }

        .ground {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10vh;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-color: black;
            z-index: 1999;
            transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: height;
        }

        .ground.expanding {
            height: 100vh;
            z-index: 1999;
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .building-container {
            position: absolute;
            bottom: 10vh;  /* Keep this to align with ground */
            height: calc(100vh - 10vh);  /* Fill from ground to top */
            width: 48vh;
            transform-origin: bottom center;
            background-color: rgba(255, 0, 0, 0);
        }

        .house {
            position: absolute;
            bottom: 0;
            height: 100%;  /* Fill the container height */
            width: auto;   /* Width will adjust to maintain aspect ratio */
            object-fit: contain;  /* Maintain aspect ratio while filling height */
            user-select: none;
            z-index: 100;
            pointer-events: auto; /* Enable clicks on house image */
            cursor: none;
        }

        .house-click-blocker {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            background-color: transparent;
            z-index: 103;
            pointer-events: auto; /* Block clicks on top portion */
            cursor: none;
        }

        .house-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: red;
            transform: translateY(-50%);
            z-index: 101;
            pointer-events: none;
            opacity: 0; /* Hide the line but keep it for positioning calculations */
        }

        /* Individual line height adjustments */
        #house-line-anni {
            top: 35%; /* Adjust this value to change the line position (0% = top, 100% = bottom) */
        }

        #house-line-1 {
            top: 12%;
        }

        #house-line-4 {
            top: 43%;
        }

        #house-line-2 {
            top: 25%;
        }

        #building1 { 
            left: 1150px; 
            z-index: 10;
            transform-origin: bottom center;
            transform: scale(1);
        }
        #building2 { 
            left: 1600px; 
            z-index: 3;
            transform-origin: bottom center;
            transform: scale(1);
        }
        #anni-building { 
            left: 400px; 
            z-index: 2;
            transform-origin: bottom center;
            transform: scale(1);
        }
        #building4 { 
            left: 800px; 
            z-index: 1;
            transform-origin: bottom center;
            transform: scale(1);
        }

        .car {
            position: fixed;
            bottom: 9.9vh;
            height: 7vh;
            width: auto;
            object-fit: contain;
            user-select: none;
            z-index: 4;
            left: 15px;
        }


        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .title {
            position: fixed;
            top: 20px;
            left: 20px;
            height: auto;
            width: calc(100% - 40px);
            z-index: 1; /* ensures it stays on top */
            pointer-events: none; /* prevents it from interfering with scrolling */
            user-select: none;
        }

        .click {
            position: absolute;
            height: 10%;  /* Adjust size as needed */
            width: auto;
            bottom: 25%;  /* Adjust position as needed */
            left: -25%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
        }

        .birds {
            position: absolute;
            height: 20%;  /* Adjust size as needed */
            width: auto;
            bottom: 50%;  /* Adjust position as needed */
            left: 210%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
        }

        .palmtree {
            position: absolute;
            height: 50%;  /* Adjust size as needed */
            width: auto;
            bottom: -5%;  /* Adjust position as needed */
            left: 240%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
        }

        .sixten {
            position: absolute;
            height: 10%;  /* Adjust size as needed */
            width: auto;
            bottom: 64.5%;  /* Adjust position as needed */
            left: 44%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
            filter: grayscale(100%);
        }

        .butterfly {
            position: absolute;
            height: 12%;  /* Adjust size as needed */
            width: auto;
            bottom: 48.5%;  /* Adjust position as needed */
            left: 51%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 1;
        }

    </style>
    <script>
        
        // Function to update car and building positions based on horizontal scroll
        function updateScrollEffects() {
            const scrolled = document.body.scrollLeft;
            const bodyScrollWidth = document.body.scrollWidth;
            const maxScroll = Math.max(bodyScrollWidth - window.innerWidth, 0);
            
            // Calculate car position relative to scroll progress
            const car = document.getElementById('car');
            if (car && maxScroll > 0) {
                const clampedScroll = Math.min(Math.max(scrolled, 0), maxScroll);
                const progress = clampedScroll / maxScroll;
                const maxCarTravel = window.innerWidth - car.offsetWidth - 30;
                const carPosition = progress * maxCarTravel;
                car.style.transform = `translateX(${carPosition}px)`;
            } else if (car) {
                car.style.transform = 'translateX(0px)';
            }

            // Move buildings at different speeds
            const building1 = document.getElementById('building1');
            const building2 = document.getElementById('building2');
            const anniBuilding = document.getElementById('anni-building');
            const building4 = document.getElementById('building4');
            
            if (building1) building1.style.transform = `translateX(${scrolled * -0.3}px)`;
            if (building2) building2.style.transform = `translateX(${scrolled * 0}px)`;
            if (anniBuilding) anniBuilding.style.transform = `translateX(${scrolled * 0.1}px)`;
            if (building4) building4.style.transform = `translateX(${scrolled * 0.2}px)`;
        }
        
        // Wheel event for horizontal scroll
        window.addEventListener('wheel', function(e) {
            e.preventDefault();
            document.body.scrollLeft += e.deltaY;
            updateScrollEffects();
        }, { passive: false });

        // Function to handle navigation with ground expansion
        function navigateWithTransition(url) {
            // Save current horizontal scroll position before navigating
            sessionStorage.setItem('cityScrollPosition', document.body.scrollLeft.toString());
            
            const ground = document.querySelector('.ground');
            ground.classList.add('expanding');
            
            // Wait for animation to complete before navigating
            ground.addEventListener('transitionend', function onTransitionEnd() {
                ground.removeEventListener('transitionend', onTransitionEnd);
                window.location.href = url;
            }, { once: true });
        }

        // Position red lines to match house widths and set up click blockers
        function positionHouseLines() {
            requestAnimationFrame(function() {
                const houses = document.querySelectorAll('.house');
                houses.forEach(function(house) {
                    const line = house.nextElementSibling;
                    if (line && line.classList.contains('house-line')) {
                        const container = house.parentElement;
                        const containerHeight = container.offsetHeight;
                        const containerWidth = container.offsetWidth;
                        
                        // Set line width to match house width (or container width as fallback)
                        const houseWidth = house.offsetWidth || containerWidth;
                        if (houseWidth > 0 && containerHeight > 0) {
                            line.style.width = houseWidth + 'px';
                            line.style.left = '0px';
                            
                            // Position click blocker to cover top portion (above the line)
                            const blocker = line.nextElementSibling;
                            if (blocker && blocker.classList.contains('house-click-blocker')) {
                                // Get the line's actual position relative to container
                                const lineRect = line.getBoundingClientRect();
                                const containerRect = container.getBoundingClientRect();
                                const lineTopPx = lineRect.top - containerRect.top + (lineRect.height / 2); // Use center of line
                                
                                // Position from top to line center (blocks clicks above the line)
                                blocker.style.top = '0px';
                                blocker.style.bottom = '';
                                blocker.style.height = lineTopPx + 'px';
                                blocker.style.width = houseWidth + 'px';
                                blocker.style.left = '0px';
                                blocker.style.display = 'block'; // Ensure it's visible
                            }
                        }
                    }
                });
            });
        }

        // Ground animation state - prevent multiple triggers
        let groundAnimationTriggered = false;
        
        // Function to animate ground down - ensures it only happens once
        // Defined in global scope so it's accessible everywhere
        function animateGroundDown() {
            const ground = document.querySelector('.ground');
            if (!ground) return;
            
            // Use the guard to prevent multiple triggers
            if (groundAnimationTriggered) return;
            if (ground.classList.contains('expanding')) return;
            groundAnimationTriggered = true;
            
            // Ensure it's in loading state first
            if (!ground.classList.contains('loading')) {
                ground.classList.add('loading');
                ground.offsetHeight; // Force reflow
            }
            
            // Then animate down
            requestAnimationFrame(function() {
                requestAnimationFrame(function() {
                    ground.classList.remove('loading');
                });
            });
        }
        
        // Function to initialize ground animation
        function initializeGroundAnimation() {
            const ground = document.querySelector('.ground');
            
            if (ground) {
                // Reset the ground to loading state
                ground.classList.remove('expanding');
                ground.classList.add('loading');
                // Force a reflow to ensure the browser applies the 100vh state
                ground.offsetHeight;
            }
            
            // Reset the trigger flag so animation can run again
            groundAnimationTriggered = false;
            
            // Use the animation function
            setTimeout(animateGroundDown, 600);
        }
        
        // Loading screen functionality - ground animation (reversed)
        // Ensure ground starts in loading state immediately
        document.addEventListener('DOMContentLoaded', function() {
            initializeGroundAnimation();
        });
        
        // Handle page restoration from back/forward cache (bfcache)
        // This ensures the ground animation plays when using browser back button
        window.addEventListener('pageshow', function(event) {
            // event.persisted is true when page is restored from bfcache
            if (event.persisted) {
                // Reset and re-trigger the ground animation
                initializeGroundAnimation();
            }
        });
        
        window.addEventListener('load', function() {
            const ground = document.querySelector('.ground');
            const body = document.body;
            const images = document.querySelectorAll('img');
            const video = document.querySelector('.background-video');
            
            let imagesLoaded = 0;
            let videoLoaded = false;
            let isLoadingComplete = false;
            const totalImages = images.length;
            const totalAssets = totalImages + (video ? 1 : 0);
            
            // Check if all images are loaded
            function checkImageLoad() {
                imagesLoaded++;
                if (imagesLoaded === totalImages && videoLoaded) {
                    hideLoadingScreen();
                }
            }
            
            // Check if video is loaded
            function checkVideoLoad() {
                if (video.readyState >= 3) { // HAVE_FUTURE_DATA or higher
                    videoLoaded = true;
                    if (imagesLoaded === totalImages) {
                        hideLoadingScreen();
                    }
                } else {
                    video.addEventListener('canplaythrough', function() {
                        videoLoaded = true;
                        if (imagesLoaded === totalImages) {
                            hideLoadingScreen();
                        }
                    }, { once: true });
                }
            }
            
            function hideLoadingScreen() {
                isLoadingComplete = true;
                
                // Remove loading class from ground to trigger reverse animation
                const ground = document.querySelector('.ground');
                if (ground) {
                    ground.classList.remove('loading');
                }
                
                body.classList.remove('loading');
                body.classList.add('loaded');
                
                // Restore scroll position if coming back from a project page
                const savedScrollPosition = sessionStorage.getItem('cityScrollPosition');
                if (savedScrollPosition !== null) {
                    // Wait a bit for the page to fully render before restoring scroll
                    setTimeout(() => {
                        // Restore horizontal scroll
                        document.body.scrollLeft = parseInt(savedScrollPosition, 10);
                        
                        // Update building positions and car based on scroll
                        const scrolled = document.body.scrollLeft;
                        const building1 = document.getElementById('building1');
                        const building2 = document.getElementById('building2');
                        const anniBuilding = document.getElementById('anni-building');
                        const building4 = document.getElementById('building4');
                        const car = document.getElementById('car');
                        
                        if (building1) building1.style.transform = `translateX(${scrolled * -0.3}px)`;
                        if (building2) building2.style.transform = `translateX(${scrolled * 0}px)`;
                        if (anniBuilding) anniBuilding.style.transform = `translateX(${scrolled * 0.1}px)`;
                        if (building4) building4.style.transform = `translateX(${scrolled * 0.2}px)`;
                        
                        // Update car position
                        if (car) {
                            const bodyScrollWidth = document.body.scrollWidth;
                            const maxScroll = Math.max(bodyScrollWidth - window.innerWidth, 0);
                            if (maxScroll > 0) {
                                const clampedScroll = Math.min(Math.max(scrolled, 0), maxScroll);
                                const progress = clampedScroll / maxScroll;
                                const maxCarTravel = window.innerWidth - car.offsetWidth - 30;
                                const carPosition = progress * maxCarTravel;
                                car.style.transform = `translateX(${carPosition}px)`;
                            }
                        }
                        
                        // Position house lines after layout is restored
                        positionHouseLines();
                        
                        // Clear the saved position after restoring
                        sessionStorage.removeItem('cityScrollPosition');
                    }, 100);
                }
            }
            
            // Handle image loading
            images.forEach(function(img) {
                if (img.complete) {
                    checkImageLoad();
                } else {
                    img.addEventListener('load', checkImageLoad, { once: true });
                    img.addEventListener('error', checkImageLoad, { once: true }); // Count errors too to not block
                }
            });
            
            // Handle video loading
            if (video) {
                checkVideoLoad();
            } else {
                videoLoaded = true;
                if (imagesLoaded === totalImages) {
                    hideLoadingScreen();
                }
            }
            
            // Timeout fallback
            setTimeout(function() {
                if (!body.classList.contains('loaded')) {
                    hideLoadingScreen();
                }
            }, 5000);
        });

        // Setup house click handlers after images are loaded
        window.addEventListener('load', function() {
            // Click handlers for house images (only bottom portions will be clickable due to blockers)
            const house1 = document.querySelector('#building1 .house');
            const house2 = document.querySelector('#building2 .house');
            const anniHouse = document.querySelector('#anni-building .house');
            const house4 = document.querySelector('#building4 .house');
            
            if (house1) {
                house1.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    navigateWithTransition('project3.html');
                });
            }
            
            if (house2) {
                house2.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    navigateWithTransition('project2.html');
                });
            }
            
            if (anniHouse) {
                anniHouse.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    navigateWithTransition('project1.html');
                });
            }
            
            if (house4) {
                house4.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    navigateWithTransition('project4.html');
                });
            }

            // Position lines after images are loaded - with retry
            positionHouseLines();
            // Retry after a short delay to ensure dimensions are calculated
            setTimeout(positionHouseLines, 100);
            setTimeout(positionHouseLines, 500);
            // Also position on window resize
            window.addEventListener('resize', positionHouseLines);
        });

        // Add click handlers for buildings, set logo, and wire up custom cursor - wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            // Build the animated cursor element
            const cursor = document.createElement('div');
            cursor.className = 'custom-cursor';
            const cursorShape = document.createElement('div');
            cursorShape.className = 'custom-cursor-shape';
            const cursorText = document.createElement('div');
            cursorText.className = 'custom-cursor-text';
            cursorShape.appendChild(cursorText);
            cursor.appendChild(cursorShape);
            document.body.appendChild(cursor);

            // Map building IDs to project names
            const projectNames = {
                'anni-building': 'ANNI SUSHI',
                'building1': 'LOTTA HASSELBLAD',
                'building2': 'PROJECT 2',
                'building4': 'PROJECT 4'
            };

            // Track the cursor position with a small easing for smoothness
            let cursorX = -100, cursorY = -100;
            let targetX = -100, targetY = -100;

            function renderCursor() {
                // simple lerp to soften movement
                cursorX += (targetX - cursorX) * 0.35;
                cursorY += (targetY - cursorY) * 0.35;
                cursor.style.transform = `translate3d(${cursorX}px, ${cursorY}px, 0)`;
                requestAnimationFrame(renderCursor);
            }
            renderCursor();

            document.addEventListener('mousemove', (e) => {
                targetX = e.clientX;
                targetY = e.clientY;
            });

            // Toggle hover state on interactive elements (house images)
            const hoverTargets = document.querySelectorAll('.house');
            hoverTargets.forEach(el => {
                // Find the parent building container to get the project name
                const buildingContainer = el.closest('.building-container');
                const buildingId = buildingContainer ? buildingContainer.id : null;
                const projectName = buildingId ? projectNames[buildingId] : '';
                
                el.addEventListener('mouseenter', () => {
                    cursorText.textContent = projectName;
                    cursor.classList.add('is-hovering');
                });
                el.addEventListener('mouseleave', () => {
                    cursor.classList.remove('is-hovering');
                });
            });

            // Set logo
            const titleImg = document.querySelector('.title');
            if (titleImg) {
                titleImg.src = 'resources/namelogo.svg';
            }
            
            // Handle background video loading for Chrome compatibility
            const backgroundVideo = document.querySelector('.background-video');
            if (backgroundVideo) {
                // Check if video can play - Chrome doesn't support .mov files
                backgroundVideo.addEventListener('error', function() {
                    // If video fails to load, hide it so background shows through
                    backgroundVideo.style.display = 'none';
                }, true);
                
                // Also check after a short delay if video hasn't started playing
                setTimeout(function() {
                    if (backgroundVideo.readyState === 0 || backgroundVideo.readyState === 1) {
                        // Video hasn't loaded or can't play
                        backgroundVideo.style.display = 'none';
                    }
                }, 2000);
            }
        });
    </script>
</head>
<body class="loading">
    <video class="background-video" autoplay loop muted playsinline webkit-playsinline preload="auto">
        <source src="resources/clouds.mp4" type="video/mp4">
    </video>
    <img src="resources/namelogo.svg" class="title" alt="Title">
    <div class="background"></div>
    <div class="scene-container">
        <div id="anni-building" class="building-container">
            <img src="resources/house 3.png" class="house" alt="Anni House">
            <div id="house-line-anni" class="house-line"></div>
            <div id="house-blocker-anni" class="house-click-blocker"></div>
            <img src="resources/click.gif" class="click" alt="Click">
            <img src="resources/birds.gif" class="birds" alt="Birds">
            <img src="resources/butterfly.gif" class="butterfly" alt="Butterfly">
        </div>
        
        <div id="building1" class="building-container">
            <img src="resources/house 1.png" class="house" alt="House 1">
            <div id="house-line-1" class="house-line"></div>
            <div id="house-blocker-1" class="house-click-blocker"></div>
            <img src="resources/palmtree.gif" class="palmtree" alt="Palm tree">
        </div>
        
        <div id="building4" class="building-container">
            <img src="resources/house 4.png" class="house" alt="House 4">
            <div id="house-line-4" class="house-line"></div>
            <div id="house-blocker-4" class="house-click-blocker"></div>
        </div>
        
        <div id="building2" class="building-container">
            <img src="resources/house 2.png" class="house" alt="House 2">
            <div id="house-line-2" class="house-line"></div>
            <div id="house-blocker-2" class="house-click-blocker"></div>
            <img src="resources/sixten.gif" class="sixten" alt="Sixten">
        </div>
        
        <img src="resources/car.png" class="car" id="car" alt="Car">
        <div class="ground loading"></div>
    </div>
</body>
</html>

