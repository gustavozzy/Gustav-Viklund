<!DOCTYPE html>
<html>
<head>
    <style>
        @font-face {
            font-family: 'printf';
            src: url('resources/PRINTF Regular.ttf') format('truetype');
        }
        
        html {
            overflow: hidden;
        }
        
        body {
            background-color: rgb(0, 0, 0);
            margin: 0;
            padding: 0;
            height: 100vh;
            position: relative;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: none;
            overscroll-behavior-x: none;
            overscroll-behavior-y: none;
            cursor: none; /* Use the custom cursor instead of the native one */
        }
        
        /* Loading screen - ground starts expanded and shrinks down */
        .ground.loading {
            height: 100vh;
            z-index: 1999;
        }
        
        
        /* Custom cursor: outer follows position, inner handles scale transition */
        .custom-cursor {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 2000;
            transform: translate3d(-100px, -100px, 0);
        }
        .custom-cursor .custom-cursor-shape {
            width: 16px;
            height: 16px;
            margin-left: -8px;
            margin-top: -8px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0;
            transform: scale(1);
            transition: transform 320ms ease, background 320ms ease, border-radius 320ms ease;
        }
        .custom-cursor.is-hovering .custom-cursor-shape {
            transform: scale(1.45);
        }

        .background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            pointer-events: none;
            transform: scaleX(-1);
        }
        
        .background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
            pointer-events: none;
            transform: scaleX(-1);
        }
        
        .scene-container {
            position: relative;
            height: 100%;
            width: calc(1650px + 48vh + 100px); /* Content width + start padding + end padding */
        }

        .ground {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10vh;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-color: black;
            z-index: 1999;
            transition: height 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: height;
        }

        .ground.expanding {
            height: 100vh;
            z-index: 1999;
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .building-container {
            position: absolute;
            bottom: 10vh;  /* Keep this to align with ground */
            height: calc(100vh - 10vh);  /* Fill from ground to top */
            width: 48vh;
            transform-origin: bottom center;
            background-color: rgba(255, 0, 0, 0);
        }

        .house {
            position: absolute;
            bottom: 0;
            height: 100%;  /* Fill the container height */
            width: auto;   /* Width will adjust to maintain aspect ratio */
            object-fit: contain;  /* Maintain aspect ratio while filling height */
            user-select: none;
            z-index: 100;
            pointer-events: auto;
        }

        #building1 { 
            left: 1150px; 
            z-index: 10;
            transform-origin: bottom center;
            transform: scale(1);
        }
        #building2 { 
            left: 1650px; 
            z-index: 3;
            transform-origin: bottom center;
            transform: scale(1);
        }
        #anni-building { 
            left: 300px; 
            z-index: 2;
            transform-origin: bottom center;
            transform: scale(1);
        }
        #building4 { 
            left: 650px; 
            z-index: 1;
            transform-origin: bottom center;
            transform: scale(1);
        }

        .car {
            position: fixed;
            bottom: 9.9vh;
            height: 7vh;
            width: auto;
            object-fit: contain;
            user-select: none;
            z-index: 4;
            left: 15px;
        }

        .billboard {
            position: absolute;
            width: 37%;
            height: 24.4%;
            bottom: 40.3%;
            left: 9%;
            transform: matrix(1, -0.04, 0, 1, 0, 0);
            pointer-events: none;
        }

        .billboard-image {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .billboard-image[src*="static.gif"] {
            filter: grayscale(100%);
        }

        .billboard-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(255, 252, 246);
            pointer-events: none;
            z-index: 1;
            mix-blend-mode: color;
            display: none;
        }

        .billboard2 {
            position: absolute;
            width: 37%;
            height: 9.2%;
            bottom: 30.5%;
            left: 9%;
            transform: matrix(1, -0.03, 0, 1, 0, 0);
        }

        .billboard3 {
            position: absolute;
            width: 14.9%;
            height: 38.5%;
            bottom: 25.8%;
            left: 49.3%;
            transform: matrix(1, -0.02, 0, 1, 0, 0);
        }

        .billboard4 {
            position: absolute;
            width: 30.5%;
            height: 7.2%;
            bottom: 76.8%;
            left: 35.6%;
            transform: matrix(1, 0.33, 0, 1, 0, 0);
        }

        .billboard5 {
            position: absolute;
            width: 31.5%;
            height: 30.5%;
            bottom: 16.8%;
            left: 24.3%;
            transform: matrix(1, -0.03, 0, 1, 0, 0);
        }

        .billboard6 {
            position: absolute;
            width: 12.4%;
            height: 31.7%;
            bottom: 30.6%;
            left: 72.1%;
            transform: matrix(1, 0.11, 0, 1, 0, 0);
        }

        .billboard7 {
            position: absolute;
            width: 21.6%;
            height: 25.4%;
            bottom: 11.7%;
            left: 23.2%;
            transform: matrix(1, -0.05, 0, 1, 0, 0);
        }

        .billboard8 {
            position: absolute;
            width: 17.8%;
            height: 14.6%;
            bottom: 30.6%;
            left: 53.1%;
            transform: matrix(1, 0.08, 0, 1, 0, 0);
        }

        .billboard9 {
            position: absolute;
            width: 26.8%;
            height: 6.8%;
            bottom: 15.8%;
            left: 48.7%;
            transform: matrix(1, 0.04, 0, 1, 0, 0);
        }

        .billboard10 {
            position: absolute;
            width: 31.1%;
            height: 5.5%;
            bottom: 33%;
            left: 19.5%;
            transform: matrix(1, -0.07, 0, 1, 0, 0);
        }

        .billboard11 {
            position: absolute;
            width: 31.1%;
            height: 6.9%;
            bottom: 24.5%;
            left: 19.5%;
            transform: matrix(1, -0.05, 0, 1, 0, 0);
        }

        .billboard12 {
            position: absolute;
            width: 10.5%;
            height: 40.1%;
            bottom: 4.3%;
            left: 67.9%;
            transform: matrix(1, 0.05, 0, 1, 0, 0);
        }

        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .title {
            position: fixed;
            top: 20px;
            left: 20px;
            height: auto;
            width: calc(100% - 40px);
            z-index: 1; /* ensures it stays on top */
            pointer-events: none; /* prevents it from interfering with scrolling */
            user-select: none;
        }

        .click {
            position: absolute;
            height: 10%;  /* Adjust size as needed */
            width: auto;
            bottom: 25%;  /* Adjust position as needed */
            left: -5%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
        }

        .birds {
            position: absolute;
            height: 20%;  /* Adjust size as needed */
            width: auto;
            bottom: 50%;  /* Adjust position as needed */
            left: 210%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
        }

        .palmtree {
            position: absolute;
            height: 50%;  /* Adjust size as needed */
            width: auto;
            bottom: -5%;  /* Adjust position as needed */
            left: 240%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
        }

        .sixten {
            position: absolute;
            height: 10%;  /* Adjust size as needed */
            width: auto;
            bottom: 64.5%;  /* Adjust position as needed */
            left: 44%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 100;
            filter: grayscale(100%);
        }

        .butterfly {
            position: absolute;
            height: 12%;  /* Adjust size as needed */
            width: auto;
            bottom: 47%;  /* Adjust position as needed */
            left: 57.3%;    /* Adjust position as needed */
            object-fit: contain;
            user-select: none;
            z-index: 1;
        }
    </style>
    <script>
        window.addEventListener('wheel', function(e) {
            e.preventDefault();
            
            document.body.scrollLeft += e.deltaY;

            // Get the current scroll position and the full horizontal scrollable range
            const scrolled = document.body.scrollLeft;
            const bodyScrollWidth = document.body.scrollWidth;
            const maxScroll = Math.max(bodyScrollWidth - window.innerWidth, 0);
            
            // Calculate car position relative to scroll progress,
            // ensuring it reaches the end exactly when scrolling reaches its end
            const car = document.getElementById('car');
            if (car && maxScroll > 0) {
                const clampedScroll = Math.min(Math.max(scrolled, 0), maxScroll);
                const progress = clampedScroll / maxScroll; // 0 → start, 1 → end of scroll
                const maxCarTravel = window.innerWidth - car.offsetWidth - 30; // from initial left to right edge
                const carPosition = progress * maxCarTravel;
                car.style.transform = `translateX(${carPosition}px)`;
            } else if (car) {
                // No horizontal scroll available, keep car at start
                car.style.transform = 'translateX(0px)';
            }

            // Move buildings at different speeds
            const building1 = document.getElementById('building1');
            const building2 = document.getElementById('building2');
            const anniBuilding = document.getElementById('anni-building');
            const building4 = document.getElementById('building4');
            
            building1.style.transform = `translateX(${scrolled * -0.3}px)`;  // Billboard will move with this
            building2.style.transform = `translateX(${scrolled * 0}px)`;
            anniBuilding.style.transform = `translateX(${scrolled * 0.1}px)`;
            building4.style.transform = `translateX(${scrolled * 0.2}px)`;
        }, { passive: false });

        // Function to handle navigation with ground expansion
        function navigateWithTransition(url) {
            // Save current scroll position before navigating
            sessionStorage.setItem('cityScrollPosition', document.body.scrollLeft.toString());
            
            const ground = document.querySelector('.ground');
            ground.classList.add('expanding');
            
            // Wait for animation to complete before navigating
            ground.addEventListener('transitionend', function onTransitionEnd() {
                ground.removeEventListener('transitionend', onTransitionEnd);
                window.location.href = url;
            }, { once: true });
        }

        // Loading screen functionality - ground animation (reversed)
        // Ensure ground starts in loading state immediately
        document.addEventListener('DOMContentLoaded', function() {
            const ground = document.querySelector('.ground');
            if (ground) {
                ground.classList.add('loading');
            }
        });
        
        window.addEventListener('load', function() {
            const ground = document.querySelector('.ground');
            const body = document.body;
            const images = document.querySelectorAll('img');
            const video = document.querySelector('.background-video');
            
            let imagesLoaded = 0;
            let videoLoaded = false;
            const totalImages = images.length;
            
            // Check if all images are loaded
            function checkImageLoad() {
                imagesLoaded++;
                if (imagesLoaded === totalImages && videoLoaded) {
                    hideLoadingScreen();
                }
            }
            
            // Check if video is loaded
            function checkVideoLoad() {
                if (video.readyState >= 3) { // HAVE_FUTURE_DATA or higher
                    videoLoaded = true;
                    if (imagesLoaded === totalImages) {
                        hideLoadingScreen();
                    }
                } else {
                    video.addEventListener('canplaythrough', function() {
                        videoLoaded = true;
                        if (imagesLoaded === totalImages) {
                            hideLoadingScreen();
                        }
                    }, { once: true });
                }
            }
            
            function hideLoadingScreen() {
                // Remove loading class from ground to trigger reverse animation
                if (ground) {
                    ground.classList.remove('loading');
                    // Ground z-index is already set in CSS to stay on top
                }
                
                body.classList.remove('loading');
                body.classList.add('loaded');
                
                // Restore scroll position if coming back from a project page
                const savedScrollPosition = sessionStorage.getItem('cityScrollPosition');
                if (savedScrollPosition !== null) {
                    // Wait a bit for the page to fully render before restoring scroll
                    setTimeout(() => {
                        document.body.scrollLeft = parseInt(savedScrollPosition, 10);
                        // Also update building positions based on scroll
                        const scrolled = document.body.scrollLeft;
                        const building1 = document.getElementById('building1');
                        const building2 = document.getElementById('building2');
                        const anniBuilding = document.getElementById('anni-building');
                        const building4 = document.getElementById('building4');
                        const car = document.getElementById('car');
                        
                        if (building1) building1.style.transform = `translateX(${scrolled * -0.3}px)`;
                        if (building2) building2.style.transform = `translateX(${scrolled * 0}px)`;
                        if (anniBuilding) anniBuilding.style.transform = `translateX(${scrolled * 0.1}px)`;
                        if (building4) building4.style.transform = `translateX(${scrolled * 0.2}px)`;
                        
                        // Update car position
                        if (car) {
                            const bodyScrollWidth = document.body.scrollWidth;
                            const maxScroll = Math.max(bodyScrollWidth - window.innerWidth, 0);
                            if (maxScroll > 0) {
                                const clampedScroll = Math.min(Math.max(scrolled, 0), maxScroll);
                                const progress = clampedScroll / maxScroll;
                                const maxCarTravel = window.innerWidth - car.offsetWidth - 30;
                                const carPosition = progress * maxCarTravel;
                                car.style.transform = `translateX(${carPosition}px)`;
                            }
                        }
                        
                        // Clear the saved position after restoring
                        sessionStorage.removeItem('cityScrollPosition');
                    }, 100);
                }
            }
            
            // Handle image loading
            images.forEach(function(img) {
                if (img.complete) {
                    checkImageLoad();
                } else {
                    img.addEventListener('load', checkImageLoad, { once: true });
                    img.addEventListener('error', checkImageLoad, { once: true }); // Count errors too to not block
                }
            });
            
            // Handle video loading
            if (video) {
                checkVideoLoad();
            } else {
                videoLoaded = true;
                if (imagesLoaded === totalImages) {
                    hideLoadingScreen();
                }
            }
            
            // Fallback: hide loading screen after max 5 seconds even if not everything loaded
            setTimeout(function() {
                if (!body.classList.contains('loaded')) {
                    hideLoadingScreen();
                }
            }, 5000);
        });

        // Add click handlers for buildings, set logo, and wire up custom cursor - wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            // Build the animated cursor element
            const cursor = document.createElement('div');
            cursor.className = 'custom-cursor';
            const cursorShape = document.createElement('div');
            cursorShape.className = 'custom-cursor-shape';
            cursor.appendChild(cursorShape);
            document.body.appendChild(cursor);

            // Track the cursor position with a small easing for smoothness
            let cursorX = -100, cursorY = -100;
            let targetX = -100, targetY = -100;

            function renderCursor() {
                // simple lerp to soften movement
                cursorX += (targetX - cursorX) * 0.35;
                cursorY += (targetY - cursorY) * 0.35;
                cursor.style.transform = `translate3d(${cursorX}px, ${cursorY}px, 0)`;
                requestAnimationFrame(renderCursor);
            }
            renderCursor();

            document.addEventListener('mousemove', (e) => {
                targetX = e.clientX;
                targetY = e.clientY;
            });

            // Toggle hover state on interactive elements
            const hoverTargets = document.querySelectorAll('.building-container, .house');
            hoverTargets.forEach(el => {
                el.addEventListener('mouseenter', () => cursor.classList.add('is-hovering'));
                el.addEventListener('mouseleave', () => cursor.classList.remove('is-hovering'));
            });

            // Set logo to namelogo3
            const titleImg = document.querySelector('.title');
            if (titleImg) {
                titleImg.src = `resources/namelogo3.svg`;
            }
            
            // Add click handlers to building containers
            document.getElementById('building1').addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project3.html');
            });

            document.getElementById('building2').addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project2.html');
            });

            document.getElementById('anni-building').addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project1.html');
            });

            document.getElementById('building4').addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project4.html');
            });

            // Also add click handlers to house images in case they block the container
            const house1 = document.querySelector('#building1 .house');
            const house2 = document.querySelector('#building2 .house');
            const anniHouse = document.querySelector('#anni-building .house');
            const house4 = document.querySelector('#building4 .house');

            if (house1) house1.addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project3.html');
            });
            if (house2) house2.addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project2.html');
            });
            if (anniHouse) anniHouse.addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project1.html');
            });
            if (house4) house4.addEventListener('click', function(e) {
                e.stopPropagation();
                e.preventDefault();
                navigateWithTransition('project4.html');
            });
        });
    </script>
</head>
<body class="loading">
    <video class="background-video" autoplay loop muted playsinline>
        <source src="resources/clouds.mov" type="video/quicktime">
        <source src="resources/clouds.mp4" type="video/mp4">
    </video>
    <img src="" class="title" alt="Title">
    <div class="background"></div>
    <div class="scene-container">
        <div id="anni-building" class="building-container">
            <img src="resources/house 3.png" class="house" alt="Anni House">
            <img src="resources/click.gif" class="click" alt="Click">
            <img src="resources/birds.gif" class="birds" alt="Birds">
            <img src="resources/butterfly.gif" class="butterfly" alt="Butterfly">
            <div class="billboard billboard7">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard8">
                <img src="resources/anni_bb1.png" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard9">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
        </div>
        
        <div id="building1" class="building-container">
            <img src="resources/house 1.png" class="house" alt="House 1">
            <img src="resources/palmtree.gif" class="palmtree" alt="Palm tree">
            <div class="billboard billboard1">
                <img src="resources/anni_bb1.png" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard2">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard3">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard4">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
        </div>
        
        <div id="building4" class="building-container">
            <img src="resources/house 4.png" class="house" alt="House 4">
            <div class="billboard billboard10">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard11">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard12">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
        </div>
        
        <div id="building2" class="building-container">
            <img src="resources/house 2.png" class="house" alt="House 2">
            <img src="resources/sixten.gif" class="sixten" alt="Sixten">
            <div class="billboard billboard5">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
            <div class="billboard billboard6">
                <img src="resources/static.gif" class="billboard-image" alt="Billboard Screen">
                <div class="billboard-overlay"></div>
            </div>
        </div>
        
        <img src="resources/car.png" class="car" id="car" alt="Car">
        <div class="ground loading"></div>
    </div>
</body>
</html>
